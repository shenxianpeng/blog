---
title: Automating Multi-Dimensional Code Analysis Reports for Git Repositories via Jenkins
summary: This article describes how to use Jenkins to automatically generate multi-dimensional code analysis reports for Git repositories, including both manual and scheduled execution methods. This helps developers and teams better understand code quality and contribution.
tags:
  - Stats
  - Git
translate: fase
date: 2020-01-21
author: shenxianpeng
---

In a previous post (GitStats—A Git History Statistics Tool), I provided my boss with all the Git commit history analysis reports he wanted to see for all the repositories. I deployed all the reports to a virtual machine's Tomcat server, so my boss could access and view the analysis reports for each repository through a URL—seeing who contributed the most, who was active, who was slacking off, and who was coding on weekends (996 is discouraged here).

Recently, my boss had a request.

_Boss: Why isn't the data on this URL updating?  I don't see any of your code commits in the report._
_Me: Boss, all the data for these repositories is manually generated by me.  Could you give me some time to automate this task?_



My proactive approach isn't flattery; I know that if my boss finds the Git Stats tool useful, he'll want to see the latest analysis reports.  Since he brought it up, I shouldn't delay—let's get to work.

But how should I implement it?  Jenkins, of course.  First, I've already done many automation tasks on Jenkins, so I'm familiar with it. Second, using the same system reduces the number of system entry points, lowers the learning curve, and improves the utilization rate of the Jenkins server.

Considering my boss's needs, he certainly wouldn't want to run a Job on the Jenkins server himself to generate these multi-dimensional code analysis reports for the Git repositories. If I were the boss, I'd want:

1. This Jenkins task to run periodically, not too frequently—once a week is fine.
2. Support for individual execution for a single repository—in case the boss needs to immediately view the analysis report for a specific repository.

The final result is as follows:

## Manual Execution

The boss can select the repositories they are most interested in updating.

## Scheduled Weekly Execution

The boss can see the latest analysis data on Monday morning, showing the task "Started by timer".

## The Final Jenkinsfile

```bash
pipeline{
  agent{
    node {
      label 'main-slave'
      customWorkspace "/workspace/gitstats"
    }
  }

  environment {
    USER_CRE = credentials("d1cbab74-823d-41aa-abb7")
    webapproot = "/workspace/apache-tomcat-7.0.99/webapps/gitstats"
  }

  parameters {
    booleanParam(defaultValue: true, name: 'repo1', summary: 'uncheck to disable [repo1]')
    booleanParam(defaultValue: true, name: 'repo2', summary: 'uncheck to disable [repo2]')
  }

  triggers {
    cron '0 3 * * 7'    # Scheduled to run every Sunday morning, when the machine is idle.
  }

  options {
    buildDiscarder(logRotator(numToKeepStr:'10'))
  }

  stages{
    stage("Checkout gitstats"){
      steps{
        # Prepare the directory for storing HTML reports
        sh "mkdir -p html"
        # Download gitstats code
        sh "rm -rf gitstats && git clone https://github.com/hoxu/gitstats.git"
      }
    }
    stage("Under statistics") {
      parallel {
        stage("reop1") {
          when {
            expression { return params.repo1 }  # Check if selected
          }
          steps {
            # Clone the repository to be analyzed (repo1)
            sh 'git clone -b master https://$USER_CRE_USR:"$USER_CRE_PSW"@git.software.com/scm/repo1.git'
            # Perform historical record analysis for repository repo1
            sh "cd gitstats && ./gitstats ../repo1 ../html/repo1"
          }
          post {
            success {
              # If the analysis is successful, move the results to apache-tomcat-7.0.99/webapps/gitstats
              sh 'rm -rf ${webapproot}/repo1 && mv html/repo1 ${webapproot}'
              # Delete the repo1 code and HTML report to prevent excessive disk space usage.
              sh "rm -rf repo1"
              sh "rm -rf html/repo1"
            }
          }
        }
      }
      stage("repo2") {
          when {
            expression { return params.repo2 }
          }
          steps {
            sh 'git clone -b master https://$USER_CRE_USR:"$USER_CRE_PSW"@git.software.com/scm/repo2.git'
            sh "cd gitstats && ./gitstats ../repo2 ../html/repo2"
          }
          post {
            success {
              sh 'rm -rf ${webapproot}/repo2 && mv html/repo2 ${webapproot}'
              sh "rm -rf repo2"
              sh "rm -rf html/repo2"
            }
          }
        }
      }
    }
  }
  post{
    always{
      # Always send an email notification to the executor, cleaning the workspace regardless of success or failure.
      script {
        def email = load "vars/email.groovy"
        email.build(currentBuild.result, '')
      }
      cleanWs()
    }
  }
}
```

## Conclusion

If you are in testing, DevOps, or R&D efficiency, leveraging open-source tools like Jenkins and Git Stats can quickly help your boss or yourself provide multi-dimensional code analysis reports for Git repositories, helping you better understand the codebase.