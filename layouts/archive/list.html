{{ define "main" }}
  <article class="max-w-full">
    <header>
      {{ if .Params.showBreadcrumbs | default (.Site.Params.article.showBreadcrumbs | default false) }}
        {{ partial "breadcrumbs.html" . }}
      {{ end }}
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        {{ .Title | emojify }}
      </h1>
      {{ with .Params.description }}
        <p class="mt-2 text-lg text-neutral-500 dark:text-neutral-400">
          {{ . | emojify }}
        </p>
      {{ end }}
    </header>
    <section class="max-w-full mt-6 prose dark:prose-invert">
      {{ .Content }}
    </section>

    {{/* Auto-generate archive list by year */}}
    <section class="mt-12">
      {{/* Get all posts from posts and misc sections */}}
      {{ $posts := where .Site.RegularPages "Section" "in" (slice "posts" "misc") }}
      {{/* Filter out pages without valid dates (year > 1000) */}}
      {{ $posts = where $posts "Date.Year" "gt" 1000 }}
      
      <h2 class="text-2xl font-bold mb-6 text-neutral-900 dark:text-neutral">
        Archive
        <span class="ml-3 text-lg text-neutral-500 dark:text-neutral-400 font-normal">
          ({{ len $posts }})
        </span>
      </h2>
      
      {{/* Group posts by year */}}
      {{ range $posts.GroupByDate "2006" "desc" }}
        <div class="mb-10" id="{{ .Key }}">
          <h3 class="text-xl font-semibold mb-6 flex items-baseline">
            <a href="#{{ .Key }}" class="text-primary-600 dark:text-primary-400 hover:underline">
              {{ .Key }}
            </a>
            <span class="ml-2 text-base text-neutral-500 dark:text-neutral-400">
              ({{ len .Pages }})
            </span>
          </h3>
          
          {{/* List all articles for this year */}}
          <ul class="space-y-3 ml-4">
            {{ range .Pages.ByDate.Reverse }}
              <li class="flex items-center">
                <span class="text-sm text-neutral-500 dark:text-neutral-400 mr-4 shrink-0 w-12">
                  {{ .Date.Format "01-02" }}
                </span>
                <a href="{{ .RelPermalink }}" class="text-neutral-700 dark:text-neutral-300 hover:text-primary-600 dark:hover:text-primary-400 hover:underline">
                  {{ .Title }}
                </a>
              </li>
            {{ end }}
          </ul>
        </div>
      {{ end }}
    </section>

    <footer class="pt-8">
      {{ partial "sharing-links.html" . }}
    </footer>
  </article>
{{ end }}
